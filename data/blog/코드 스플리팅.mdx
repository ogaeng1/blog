---
title: 코드 스플리팅(Code Splitting)
date: '2023-04-09'
tags: ['프론트엔드', 'React']
draft: false
summary: '코드 스플리팅은 무엇일까'
---

리액트 프로젝트를 만들고 사용자에게 제공할 때는 빌드 작업을 거쳐 배포해야 합니다. 빌드 작업을 통해
프로젝트에서 사용되는 자바스크립트 파일 안에서 불필요한 주석, 경고 메시지, 공백 등을 제거하여 파일 크기를
최소화하기도 하고, 브라우저에서 JSX 문법이나 다른 최신 자바스크립트 문법이 원활하게 실행되도록 코드의
트랜스파일 작업도 할 수 있습니다. 프로젝트 내에 정적 파일이 있다면 해당 파일을 위한 경로도 설정됩니다.
이러한 작업은 웹팩이 담당합니다. 웹팩에서 별도의 설정을 하지 않으면 프로젝트에서 사용 중인 모든 자바스크립트
파일이 하나의 파일로 합쳐지고, 모든 CSS 파일도 하나의 파일로 합쳐집니다. 하지만 모든 자바스크립트 파일을
하나의 파일로 묶어서 빌드하는건 좋지 않습니다. 하나로 합쳐진 파일은 크기에 상관없이 우리가 자바스크립트 코드
한줄만 수정해도 다시 모든 자바스크립트 코드를 빌드해야 하는 상황이 발생합니다. 그리고 이런 파일을 분리하는
작업을 코드 스플리팅이라고 합니다.

<br />

## React.lazy와 Suspense를 통한 컴포넌트 비동기 렌더링

A, B, C로 구성된 SPA를 개발한다고 가정해 보겠습니다. 사용자가 A 페이지에 방문했다면 B,C 페이지에서 사용하는
컴포넌트 정보는 필요하지 않습니다. 사용자가 B 혹은 C 페이지로 이동할 때만 필요하면 되기 때문입니다.
하지만 리액트 프로젝트에서 별도로 설정하지 않으면 A, B, C 컴포넌트에 대한 코드가 모두 한 파일에 저장됩니다.
만약 앱의 규모가 커지면 커질수록 지금 당장 필요하지 않은 컴포넌트 정보도 모두 불러오면서 파일 크기가 아주 커지게
됩니다. 이러면 로딩이 오래 걸리고 트래픽도 많이 나오기 때문에 사용자 경험 측면에 있어 안좋습니다. 이러한 문제를
리액트에 내장된 기능인 유틸 함수 React.lazy와 컴포넌트인 Suspense를 활용하여 해결할 수 있습니다.
React.lazy와 Suspense를 사용하면 코드 스플리팅을 하기 위해 state를 따로 선언하지 않고도 간편하게 컴포넌트
코드 스플리팅을 할 수 있습니다.

## React.lazy

React.lazy는 컴포넌트를 렌더링하는 시점에서 비동기적으로 로딩할 수 있게 해 주는 유틸 함수 입니다.

```jsx
// 기존 import 방식
import Test from './경로'

// React.lazy를 통한 방식
const Test = React.lazy(() => import('./경로'))
```

## Suspense

Suspense는 리액트 내장 컴포넌트로 코드 스플리팅된 컴포넌트를 로딩하도록 발동시킬 수 있고, 로딩이 끝나지 않았을 때
보여 줄 UI를 설정할 수 있습니다.

```jsx
import { Suspense, lazy } from 'react'

const Test = React.lazy(() => import('./경로'))

const App = () => {
  return (
    <Suspense fallback={<div>로딩중...</div>}>
      <Test />
    </Suspense>
  )
}
```

Suspense에서 fallback props를 통해 로딩 중에 보여 줄 JSX를 지정할 수 있습니다.

서버 사이드 렌더링을 할 계획이 없다면 React.lazy와 Suspense로 구현하고, 계획이 있다면 Loadable Components를 사용해야 합니다.
리액트 공식 문서에서도 서버 사이드 렌더링을 할 경우 Loadable Components 라이브러리를 사용하도록 권장하고 있습니다.
추후 Loadable Components도 공부해서 내용을 정리해 보겠습니다.

도서 <strong>리액트를 다루는 기술 개정판 : 저자 김민준</strong>의 내용을 바탕으로 작성한 글 입니다.
